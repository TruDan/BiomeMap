var MiMapControl=L.Control.extend({options:{widgetLabel:""},_controlParts:{_root:null,head:null,body:null,_handle:null,_label:null},onAdd:function(n){var i=this._createControl(this.options.widgetLabel),t=this._initControl(i);return typeof t!="undefined"&&t!==null&&i.appendChild(t),this._map=n,this.getControl()},_initControl:function(){return null},_createControl:function(n){typeof n=="undefined"&&(n="");this._controlParts._root=L.DomUtil.create("div","mimap-control leaflet-control");var t=this._map;return this._controlParts._root.addEventListener("mouseover",function(){t.dragging.disable()}),this._controlParts._root.addEventListener("mouseout",function(){t.dragging.enable()}),this._controlParts.head=L.DomUtil.create("div","mimap-control-header",this._controlParts._root),this._controlParts._handle=L.DomUtil.create("i","mimap-control-handle material-icons",this._controlParts.head),this._controlParts._handle.innerHTML="drag_handle",this._controlParts._label=L.DomUtil.create("h1","",this._controlParts.head),this._controlParts._label.innerHTML=n,this._controlParts.body=L.DomUtil.create("div","mimap-control-body",this._controlParts._root),this._controlParts.body},getControl:function(){return this._controlParts._root},_createGroup:function(n,t){var i,r;return typeof n=="undefined"&&(n=""),i=L.DomUtil.create("div","mimap-control-group",t),r=L.DomUtil.create("h1","",i),r.innerHTML=n,L.DomUtil.create("div","mimap-control-group-body ui form",i)}}),MiMapLayerControl;L.Control.ChunkInfo=L.Control.extend({_hoverOverlay:null,_hoverBlockOverlay:null,_e:{},_sectionGroups:{},_sections:{},_element:null,_map:null,_selectedBlockPos:null,_selectedOverlay:null,_selectedBlockOverlay:null,_regionInfo:{},onAdd:function(n){return this._map=n,this._element=L.DomUtil.create("div","leaflet-control-chunkinfo leaflet-control-group"),this._element.style.position="relative",this._addSectionGroup("hover","Highlighted Block"),this._addSection("hover","region_pos","Region"),this._addSection("hover","chunk_pos","Chunk"),this._addSection("hover","block_pos","Block"),this._addSectionGroup("selected","Selected Block"),this._addSection("selected","region_pos","Region"),this._addSection("selected","chunk_pos","Chunk"),this._addSection("selected","block_pos","Block"),this._addSection("selected","block_id","Block ID"),this._addSection("selected","block_biome","Biome"),this._addSection("selected","block_light","Light Level"),this._bindEvents(n),this._element},onRemove:function(n){this._unbindEvents(n)},_addSectionGroup:function(n,t){var i=L.DomUtil.create("table","leaflet-control leaflet-control-chunkinfo-group"),r;this._sectionGroups[n]=i;this._element.appendChild(i);r=L.DomUtil.create("caption","leaflet-control-chunkinfo-group-label");r.innerHTML=t;i.appendChild(r)},_addSection:function(n,t,i){var f,r,u,e;n in this._sectionGroups&&(f=this._sectionGroups[n],r=L.DomUtil.create("tr"),n in this._sections||(this._sections[n]={}),f.appendChild(r),u=L.DomUtil.create("th"),r.appendChild(u),u.innerHTML=i,e=L.DomUtil.create("td"),r.appendChild(e),this._sections[n][t]=[f,u,e])},_updateSection:function(n,t,i){var r=this._sections[n][t];r[2].innerHTML=i},_bindEvents:function(n){n.on("click",this.onMapMouseClick.bind(this));n.on("mousemove",this.onMapMouseMove.bind(this));n.on("mouseout",this.onMapMouseOut.bind(this))},_unbindEvents:function(n){n.off("click",this.onMapMouseClick.bind(this));n.off("mousemove",this.onMapMouseMove.bind(this));n.off("mouseout",this.onMapMouseOut.bind(this))},__latlngToBlock:function(n){var t=this._map.getZoom(),i=256/512*(1<<t),r=this._map.project(n,t),u=Math.floor(r.x/i),f=Math.floor(-r.y/i);return L.point(u,f)},__blockToLatlng:function(n){var t=this._map.getZoom(),i=256/512*(1<<t);return this._map.unproject(L.point(n.x*i,-(n.y*i)),t)},getRegionInfo:function(n,t,i){var r=n+"_"+t,f=this,u;return(r in this._regionInfo)?(u=this._regionInfo[r],typeof i=="function"&&i(u),u):($.getJSON(window.location.pathname+"tiles/Overworld/base/.regions/"+r+".json",function(u){console.log("GetRegion",n,t,u);f._regionInfo[r]=u;typeof i=="function"&&i(u)}),null)},onMapMouseClick:function(n){var t=this.__latlngToBlock(n.latlng),r=t.x>>4,u=t.y>>4,f=this._selectedBlockPos,i,e,o;if(f!==null&&f.x===t.x&&f.y===t.y){this._selectedOverlay!==null&&(this._selectedOverlay.remove(),this._selectedOverlay=null);this._selectedBlockOverlay!==null&&(this._selectedBlockOverlay.remove(),this._selectedBlockOverlay=null);this._updateSection("selected","region_pos","");this._updateSection("selected","chunk_pos","");this._updateSection("selected","block_pos","");return}this._selectedBlockPos=t;this._updateSection("selected","region_pos","r."+(r>>5)+"."+(u>>5)+".mca");this._updateSection("selected","chunk_pos",r+", "+u);this._updateSection("selected","block_pos",t.x+", "+t.y);i=this;this.getRegionInfo(t.x>>9,t.y>>9,function(n){var r=n[t.x][t.y];if(console.log(t,r),r===null||r===undefined){i._updateSection("selected","block_id","");i._updateSection("selected","block_biome","");i._updateSection("selected","block_light","");return}i._updateSection("selected","block_id",r.blockId);i._updateSection("selected","block_biome",r.biomeId);i._updateSection("selected","block_light",r.lightLevel)});e=[this.__blockToLatlng(L.point(r<<4,u<<4)),this.__blockToLatlng(L.point(r+1<<4,u+1<<4))];this._selectedOverlay===null&&(this._selectedOverlay=L.rectangle(e,{color:"#00838F",weight:2,opacity:.2,fillOpacity:.1,pane:"overlayPane"}),this._selectedOverlay.addTo(this._map));this._selectedOverlay.setBounds(e);o=[this.__blockToLatlng(L.point(t.x,t.y)),this.__blockToLatlng(L.point(t.x+1,t.y+1))];this._selectedBlockOverlay===null&&(this._selectedBlockOverlay=L.rectangle(o,{color:"#00BCD4",weight:2,opacity:.2,fillOpacity:.1,pane:"overlayPane"}),this._selectedBlockOverlay.addTo(this._map));this._selectedBlockOverlay.setBounds(o)},onMapMouseOut:function(){this._hoverOverlay!==null&&(this._hoverOverlay.remove(),this._hoverOverlay=null);this._hoverBlockOverlay!==null&&(this._hoverBlockOverlay.remove(),this._hoverBlockOverlay=null);this._updateSection("hover","region_pos","");this._updateSection("hover","chunk_pos","");this._updateSection("hover","block_pos","")},onMapMouseMove:function(n){var t=this.__latlngToBlock(n.latlng),i=t.x>>4,r=t.y>>4,u,f;this._updateSection("hover","region_pos","r."+(i>>5)+"."+(r>>5)+".mca");this._updateSection("hover","chunk_pos",i+", "+r);this._updateSection("hover","block_pos",t.x+", "+t.y);u=[this.__blockToLatlng(L.point(i<<4,r<<4)),this.__blockToLatlng(L.point(i+1<<4,r+1<<4))];this._hoverOverlay===null&&(this._hoverOverlay=L.rectangle(u,{color:"#f1f1f1",weight:2,opacity:.4,fillOpacity:.2,pane:"overlayPane"}),this._hoverOverlay.addTo(this._map));this._hoverOverlay.setBounds(u);f=[this.__blockToLatlng(L.point(t.x,t.y)),this.__blockToLatlng(L.point(t.x+1,t.y+1))];this._hoverBlockOverlay===null&&(this._hoverBlockOverlay=L.rectangle(f,{color:"#E91E63",weight:2,opacity:.4,fillOpacity:.2,pane:"overlayPane"}),this._hoverBlockOverlay.addTo(this._map));this._hoverBlockOverlay.setBounds(f)}});L.control.chunkInfo=function(n){return new L.Control.ChunkInfo(n)};MiMapLayerControl=MiMapControl.extend({options:{widgetLabel:"Layer Select"},_layerControlParts:{_baseLayersList:null,_overlayLayersList:null},initialize:function(n,t){L.Util.setOptions(this,t);this._layerControlInputs=[];this._layers=[];this._lastZIndex=0;this._handlingClick=!1;for(var i in n)this._addLayer(n[i].layer,i,n[i].overlays)},_update:function(){if(!this._layerControlParts._baseLayersList)return this;L.DomUtil.empty(this._layerControlParts._baseLayersList);L.DomUtil.empty(this._layerControlParts._overlayLayersList);this._layerControlInputs=[];for(var i,n,r=0,t=0;t<this._layers.length;t++)if(n=this._layers[t],this._addBaseLayerItem(n),r++,this._map.hasLayer(n.layer))for(i=0;i<n.overlays.length;i++)this._addOverlayLayerItem(n.overlays[i]);return this},_initControl:function(n){this._layerControlParts._baseLayersWrapper=this._createGroup("Layers",n);this._layerControlParts._baseLayersList=L.DomUtil.create("div","grouped fields",this._layerControlParts._baseLayersWrapper);this._map.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);this._layerControlParts._overlayLayersWrapper=this._createGroup("Overlays",n);this._layerControlParts._overlayLayersList=L.DomUtil.create("div","grouped fields",this._layerControlParts._overlayLayersWrapper)},_addLayer:function(n,t,i){var u,r,f;if(this._map)n.on("add remove",this._onLayerChange,this);u=[];for(r in i){if(this._map)i[r].on("add remove",this._onLayerChange,this);u.push({layer:i[r],label:r})}f={layer:n,label:t,overlays:u};this._layers.push(f)},_addBaseLayerItem:function(n){var t=this._createItem(n);return this._layerControlParts._baseLayersList.appendChild(t),this._checkDisabledLayers(),t},_addOverlayLayerItem:function(n){var t=this._createItem(n);return this._layerControlParts._overlayLayersList.appendChild(t),this._checkDisabledLayers(),t},_getLayer:function(n){for(var i,t=0;t<this._layers.length;t++){if(this._layers[t]&&L.Util.stamp(this._layers[t].layer)===n)return this._layers[t];if(this._layers[t].overlays)for(i=0;i<this._layers[t].overlays.length;i++)if(this._layers[t].overlays[i]&&L.Util.stamp(this._layers[t].overlays[i].layer)===n)return this._layers[t].overlays[i]}},_createItem:function(n){var i,r,f=this._map.hasLayer(n.layer),t,u;i=L.DomUtil.create("div","field");typeof n.overlays=="undefined"?(r=L.DomUtil.create("div","ui checkbox",i),t=L.DomUtil.create("input"),t.type="checkbox",t.defaultChecked=f):(r=L.DomUtil.create("div","ui radio checkbox",i),t=this._createRadioElement("leaflet-base-layers",f));u=L.DomUtil.create("label");this._layerControlInputs.push(t);t.layerId=L.Util.stamp(n.layer);L.DomEvent.on(t,"click",this._onInputClick,this);return u.innerHTML=n.label,r.appendChild(t),r.appendChild(u),this._checkDisabledLayers(),i},_createRadioElement:function(n,t){var r='<input type="radio" name="'+n+'"'+(t?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=r,i.firstChild},_onLayerChange:function(n){this._handlingClick||this._update();var t=this._getLayer(L.Util.stamp(n.target)),i=typeof t.overlay=="undefined"?n.type==="add"?"overlayadd":"overlayremove":n.type==="add"?"baselayerchange":null;i&&this._map.fire(i,t)},_onInputClick:function(){var e=this._layerControlInputs,t,i,r,u=[],f=[],n;for(this._handlingClick=!0,n=e.length-1;n>=0;n--)t=e[n],i=this._getLayer(t.layerId).layer,r=this._map.hasLayer(i),t.checked&&!r?u.push(i):!t.checked&&r&&f.push(i);for(n=0;n<f.length;n++)this._map.removeLayer(f[n]);for(n=0;n<u.length;n++)this._map.addLayer(u[n]);this._handlingClick=!1;this._refocusOnMap()},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,t,n,u=this._map.getZoom(),i=r.length-1;i>=0;i--)t=r[i],n=this._getLayer(t.layerId).layer,t.disabled=n.options.minZoom!==undefined&&u<n.options.minZoom||n.options.maxZoom!==undefined&&u>n.options.maxZoom}});L.control.miMapLayerControl=function(n,t){return new MiMapLayerControl(n,t)};